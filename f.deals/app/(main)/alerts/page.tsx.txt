// app/(main)/alerts/page.tsx
import type { Metadata } from 'next';

// This function generates unique metadata for this specific page.
// Next.js will automatically use this for the <head> tag.
export const metadata: Metadata = {
  title: 'All Flight Deals & Alerts | Flight Promotion Finder',
  description: 'Browse the latest verified flight deals, price anomalies, and promotions detected by our system.',
};


// app/(main)/alerts/page.tsx
'use client';

import { useState, useEffect } from 'react';
import { DealCard } from '@/components/ui/DealCard';
import { DealCardSkeleton } from '@/components/ui/DealCardSkeleton';
import { type Deal } from '@/lib/types';
import { SearchX } from 'lucide-react';

export default function AlertsPage() {
  const [deals, setDeals] = useState<Deal[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const fetchAllDeals = async () => {
      try {
        setIsLoading(true);
        const response = await fetch('/api/deals');
        const data = await response.json();
        // To test the empty state, you can uncomment the next line:
        // setDeals([]);
        setDeals(data);
      } catch (error) {
        console.error("Failed to fetch all deals:", error);
      } finally {
        setIsLoading(false);
      }
    };
    fetchAllDeals();
  }, []);

  return (
    <div className="bg-white rounded-2xl shadow-lg p-6">
      <h2 className="text-2xl font-bold mb-6">Latest Flight Deals & Price Anomalies</h2>
      <div className="space-y-4">
        {isLoading ? (
          // Show skeleton loaders while fetching data
          <>
            <DealCardSkeleton />
            <DealCardSkeleton />
            <DealCardSkeleton />
          </>
        ) : deals.length > 0 ? (
          // If loading is done and deals exist, show them
          deals.map(deal => <DealCard key={deal.id} deal={deal} />)
        ) : (
          // If loading is done and no deals exist, show the empty state
          <div className="text-center py-16 border-2 border-dashed border-gray-300 rounded-xl">
            <div className="text-gray-400 mb-4">
              <SearchX className="mx-auto h-12 w-12" />
            </div>
            <h3 className="text-lg font-medium text-gray-700">No Deals Found</h3>
            <p className="text-gray-500">We couldn't find any active deals right now. Please check back later!</p>
          </div>
        )}
      </div>
    </div>
  );
}